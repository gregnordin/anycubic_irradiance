<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="./favicon.ico" />
    <!-- Preload is necessary because we show these images when we disconnect from the server,
    but at that point we cannot load these images from the server -->
    <link rel="preload" href="./assets/gradient-yHQUC_QB.png" as="image" />
    <link rel="preload" href="./assets/noise-60BoTA8O.png" as="image" />
    <!-- Preload the fonts -->
    <link rel="preload" href="./assets/Lora-VariableFont_wght-B2ootaw-.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" href="./assets/PTSans-Regular-CxL0S8W7.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" href="./assets/PTSans-Bold-D9fedIX3.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" href="./assets/FiraMono-Regular-BTCkDNvf.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" href="./assets/FiraMono-Medium-DU3aDxX5.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" href="./assets/FiraMono-Bold-CLVRCuM9.ttf" as="font" crossorigin="anonymous" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta name="description" content="a marimo app" />
    <link rel="apple-touch-icon" href="./apple-touch-icon.png" />
    <link rel="manifest" href="./manifest.json" />

    <script data-marimo="true">
      function __resizeIframe(obj) {
        var scrollbarHeight = 20; // Max between windows, mac, and linux

        function setHeight() {
          // Guard against race condition where iframe isn't ready
          if (!obj.contentWindow?.document?.documentElement) {
            return;
          }
          var element = obj.contentWindow.document.documentElement;
          // If there is no vertical scrollbar, we don't need to resize the iframe
          if (element.scrollHeight === element.clientHeight) {
            return;
          }

          // Create a new height that includes the scrollbar height if it's visible
          var hasHorizontalScrollbar = element.scrollWidth > element.clientWidth;
          var newHeight = element.scrollHeight + (hasHorizontalScrollbar ? scrollbarHeight : 0);

          // Only update the height if it's different from the current height
          if (obj.style.height !== `${newHeight}px`) {
            obj.style.height = `${newHeight}px`;
          }
        }

        // Resize the iframe to the height of the content and bottom scrollbar height
        setHeight();

        // Resize the iframe when the content changes
        const resizeObserver = new ResizeObserver((entries) => {
          setHeight();
        });
        // Only observe if iframe content is ready
        if (obj.contentWindow?.document?.body) {
          resizeObserver.observe(obj.contentWindow.document.body);
        }
      }
    </script>
    <marimo-filename hidden>notebook.py</marimo-filename>
    <!-- TODO(Trevor): Legacy, required by VS Code plugin. Remove when plugin is updated (see marimo/server/_templates/template.py) -->
    <marimo-version data-version="{{ version }}" hidden></marimo-version>
    <marimo-user-config data-config="{{ user_config }}" hidden></marimo-user-config>
    <marimo-server-token data-token="{{ server_token }}" hidden></marimo-server-token>
    <!-- /TODO -->
    <title>xpr irradiance visualizer</title>
    <script type="module" crossorigin src="./assets/index-CmLKiEd5.js"></script>
    <link rel="modulepreload" crossorigin href="./assets/preload-helper-DImqtvgl.js">
    <link rel="modulepreload" crossorigin href="./assets/chunk-DZLz74EQ.js">
    <link rel="modulepreload" crossorigin href="./assets/react-BcIddLXZ.js">
    <link rel="modulepreload" crossorigin href="./assets/jsx-runtime-DvsdsEjx.js">
    <link rel="modulepreload" crossorigin href="./assets/dist-CLazWf1X.js">
    <link rel="modulepreload" crossorigin href="./assets/react-dom-D6bRRS5R.js">
    <link rel="modulepreload" crossorigin href="./assets/namespace-Cw55ynVb.js">
    <link rel="modulepreload" crossorigin href="./assets/cn-CwmWKpZ_.js">
    <link rel="modulepreload" crossorigin href="./assets/dist-BiHHvE7B.js">
    <link rel="modulepreload" crossorigin href="./assets/menu-items-CE6I2UvI.js">
    <link rel="modulepreload" crossorigin href="./assets/useEventListener-g9rPKvBX.js">
    <link rel="modulepreload" crossorigin href="./assets/tslib.es6-C9vXkBtU.js">
    <link rel="modulepreload" crossorigin href="./assets/fullscreen-DoREeXhW.js">
    <link rel="modulepreload" crossorigin href="./assets/events-BGfCi1Xy.js">
    <link rel="modulepreload" crossorigin href="./assets/dist-DT6vyuIM.js">
    <link rel="modulepreload" crossorigin href="./assets/createLucideIcon-Dz-D6iuz.js">
    <link rel="modulepreload" crossorigin href="./assets/check-CmOWIaur.js">
    <link rel="modulepreload" crossorigin href="./assets/select-DIqNYEaz.js">
    <link rel="modulepreload" crossorigin href="./assets/accordion-D8h6M7fo.js">
    <link rel="modulepreload" crossorigin href="./assets/chevron-right-kGH9aJGk.js">
    <link rel="modulepreload" crossorigin href="./assets/dropdown-menu-D3tww20d.js">
    <link rel="modulepreload" crossorigin href="./assets/tooltip-CW-4dtRh.js">
    <link rel="modulepreload" crossorigin href="./assets/Logger-BkkOJyg0.js">
    <link rel="modulepreload" crossorigin href="./assets/hotkeys-ZAWHeY7d.js">
    <link rel="modulepreload" crossorigin href="./assets/react-7g8sREeT.js">
    <link rel="modulepreload" crossorigin href="./assets/_Uint8Array-D5Z9rM2X.js">
    <link rel="modulepreload" crossorigin href="./assets/_getTag-CVRrQL_Q.js">
    <link rel="modulepreload" crossorigin href="./assets/_baseIsEqual-BF8660ot.js">
    <link rel="modulepreload" crossorigin href="./assets/invariant-B43sqCFA.js">
    <link rel="modulepreload" crossorigin href="./assets/isArrayLikeObject-DKyJYtr8.js">
    <link rel="modulepreload" crossorigin href="./assets/merge-BgA7kxZb.js">
    <link rel="modulepreload" crossorigin href="./assets/zod-U2NFpcFA.js">
    <link rel="modulepreload" crossorigin href="./assets/utils-DLuqCLqV.js">
    <link rel="modulepreload" crossorigin href="./assets/requests-BW3DqHQI.js">
    <link rel="modulepreload" crossorigin href="./assets/once-4nUTgcVU.js">
    <link rel="modulepreload" crossorigin href="./assets/toDate-BNd9AHNi.js">
    <link rel="modulepreload" crossorigin href="./assets/_baseSlice-B27Cqkm6.js">
    <link rel="modulepreload" crossorigin href="./assets/_arrayMap-DQI2GUNb.js">
    <link rel="modulepreload" crossorigin href="./assets/isSymbol-xTSywenE.js">
    <link rel="modulepreload" crossorigin href="./assets/toString-CBnct2wx.js">
    <link rel="modulepreload" crossorigin href="./assets/_hasUnicode-CPHpt5EV.js">
    <link rel="modulepreload" crossorigin href="./assets/upperFirst-DOlTOwhh.js">
    <link rel="modulepreload" crossorigin href="./assets/capitalize-CkrfIDeS.js">
    <link rel="modulepreload" crossorigin href="./assets/ai-model-dropdown-D-i9tuGn.js">
    <link rel="modulepreload" crossorigin href="./assets/documentation-B7z6bB-t.js">
    <link rel="modulepreload" crossorigin href="./assets/badge-Cbb7s63B.js">
    <link rel="modulepreload" crossorigin href="./assets/button-g1jf7cM6.js">
    <link rel="modulepreload" crossorigin href="./assets/use-toast-BKA5A0CC.js">
    <link rel="modulepreload" crossorigin href="./assets/constants-Cv7-oioA.js">
    <link rel="modulepreload" crossorigin href="./assets/Deferred-Mppm0cvJ.js">
    <link rel="modulepreload" crossorigin href="./assets/config-BeIk_wvs.js">
    <link rel="modulepreload" crossorigin href="./assets/uuid-4lb_EYpq.js">
    <link rel="modulepreload" crossorigin href="./assets/key-Pb6bybhb.js">
    <link rel="modulepreload" crossorigin href="./assets/connection-UyRAkvTk.js">
    <link rel="modulepreload" crossorigin href="./assets/useLifecycle-DmdhGVVs.js">
    <link rel="modulepreload" crossorigin href="./assets/useNonce-DvpkYOW9.js">
    <link rel="modulepreload" crossorigin href="./assets/useTheme-BWXNjHkw.js">
    <link rel="modulepreload" crossorigin href="./assets/createReducer-CFr1RdS2.js">
    <link rel="modulepreload" crossorigin href="./assets/dist-BNtnpgX8.js">
    <link rel="modulepreload" crossorigin href="./assets/dist-B8v7AWk6.js">
    <link rel="modulepreload" crossorigin href="./assets/dist-Ct0a8Isf.js">
    <link rel="modulepreload" crossorigin href="./assets/dist-AWYmVWdt.js">
    <link rel="modulepreload" crossorigin href="./assets/dist-Q2QzNScK.js">
    <link rel="modulepreload" crossorigin href="./assets/dist-BFifaB39.js">
    <link rel="modulepreload" crossorigin href="./assets/dist-D80s9YgJ.js">
    <link rel="modulepreload" crossorigin href="./assets/dist-Nl79A0iO.js">
    <link rel="modulepreload" crossorigin href="./assets/dist-CtJ8WONl.js">
    <link rel="modulepreload" crossorigin href="./assets/stex-w1KpyykF.js">
    <link rel="modulepreload" crossorigin href="./assets/_baseProperty-CIKnF2iY.js">
    <link rel="modulepreload" crossorigin href="./assets/toNumber-CTOPJrpu.js">
    <link rel="modulepreload" crossorigin href="./assets/now-B6JN1xKT.js">
    <link rel="modulepreload" crossorigin href="./assets/debounce-70y9MzDK.js">
    <link rel="modulepreload" crossorigin href="./assets/toInteger-Bor4StOs.js">
    <link rel="modulepreload" crossorigin href="./assets/type-CYsuWFDa.js">
    <link rel="modulepreload" crossorigin href="./assets/marked.esm-BB_RKOA5.js">
    <link rel="modulepreload" crossorigin href="./assets/main-CCaZmKLi.js">
    <link rel="modulepreload" crossorigin href="./assets/cells-BEhFXxEH.js">
    <link rel="modulepreload" crossorigin href="./assets/kbd-CrDndhyw.js">
    <link rel="modulepreload" crossorigin href="./assets/renderShortcut-Bjp5Xukk.js">
    <link rel="modulepreload" crossorigin href="./assets/useEvent-itkPNnCe.js">
    <link rel="modulepreload" crossorigin href="./assets/useDeleteCell-CIqS2s5l.js">
    <link rel="modulepreload" crossorigin href="./assets/icons-15z_NdNZ.js">
    <link rel="modulepreload" crossorigin href="./assets/spinner-fS9J74Ro.js">
    <link rel="modulepreload" crossorigin href="./assets/datasource-CwGVmPnG.js">
    <link rel="modulepreload" crossorigin href="./assets/add-missing-import-0FwDfOhv.js">
    <link rel="modulepreload" crossorigin href="./assets/ansi_up-CAiCs1Gk.js">
    <link rel="modulepreload" crossorigin href="./assets/blob-BC4M7Onc.js">
    <link rel="modulepreload" crossorigin href="./assets/dom-Ckypy4pz.js">
    <link rel="modulepreload" crossorigin href="./assets/errors-CmwnOe1B.js">
    <link rel="modulepreload" crossorigin href="./assets/extends-B47kqttt.js">
    <link rel="modulepreload" crossorigin href="./assets/objectWithoutPropertiesLoose-ClrKK0Xi.js">
    <link rel="modulepreload" crossorigin href="./assets/esm-Bp1Lbm07.js">
    <link rel="modulepreload" crossorigin href="./assets/es-Ctpp-mTr.js">
    <link rel="modulepreload" crossorigin href="./assets/play-C5VC4Hal.js">
    <link rel="modulepreload" crossorigin href="./assets/sparkles-DLotTEZ2.js">
    <link rel="modulepreload" crossorigin href="./assets/shim-FF_l0CN4.js">
    <link rel="modulepreload" crossorigin href="./assets/add-cell-with-ai-BQY4AwHL.js">
    <link rel="modulepreload" crossorigin href="./assets/ErrorBoundary-Bj7QJPi8.js">
    <link rel="modulepreload" crossorigin href="./assets/alert-dialog-DiIW1jDy.js">
    <link rel="modulepreload" crossorigin href="./assets/dialog-gSaRWBIN.js">
    <link rel="modulepreload" crossorigin href="./assets/useDebounce-BZnPO5jA.js">
    <link rel="modulepreload" crossorigin href="./assets/numbers-P4hvbAnW.js">
    <link rel="modulepreload" crossorigin href="./assets/context-BwP_-Md9.js">
    <link rel="modulepreload" crossorigin href="./assets/useNumberFormatter-BQOmTFFk.js">
    <link rel="modulepreload" crossorigin href="./assets/input-DGY-1Oes.js">
    <link rel="modulepreload" crossorigin href="./assets/ImperativeModal-DSAh6fUR.js">
    <link rel="modulepreload" crossorigin href="./assets/filename-dpoTdlj9.js">
    <link rel="modulepreload" crossorigin href="./assets/cell-link-D8x9Ez3U.js">
    <link rel="modulepreload" crossorigin href="./assets/alert-D4GhiyiD.js">
    <link rel="modulepreload" crossorigin href="./assets/links-DH7hmhHO.js">
    <link rel="modulepreload" crossorigin href="./assets/state-5DtoeNLQ.js">
    <link rel="modulepreload" crossorigin href="./assets/MarimoErrorOutput-CD3rG7IK.js">
    <link rel="modulepreload" crossorigin href="./assets/copy-BxPDuBrN.js">
    <link rel="modulepreload" crossorigin href="./assets/copy-CGWkBrzb.js">
    <link rel="modulepreload" crossorigin href="./assets/copy-icon-7_c6G_tO.js">
    <link rel="modulepreload" crossorigin href="./assets/RenderHTML-B398JcWn.js">
    <link rel="modulepreload" crossorigin href="./assets/emotion-is-prop-valid.esm-Tm8TdcWf.js">
    <link rel="modulepreload" crossorigin href="./assets/with-selector-ChXsBWGQ.js">
    <link rel="modulepreload" crossorigin href="./assets/JsonOutput-BU4PIFXg.js">
    <link rel="modulepreload" crossorigin href="./assets/_arrayReduce-DDpPg0Qh.js">
    <link rel="modulepreload" crossorigin href="./assets/startCase-DOk4LYuA.js">
    <link rel="modulepreload" crossorigin href="./assets/strings-CrHTFiMt.js">
    <link rel="modulepreload" crossorigin href="./assets/command-W6QvsWS0.js">
    <link rel="modulepreload" crossorigin href="./assets/popover-IOch2AIR.js">
    <link rel="modulepreload" crossorigin href="./assets/table-CMFDmrFM.js">
    <link rel="modulepreload" crossorigin href="./assets/tabs-CswUuyA0.js">
    <link rel="modulepreload" crossorigin href="./assets/useAsyncData-BB0ZlY9B.js">
    <link rel="modulepreload" crossorigin href="./assets/LazyAnyLanguageCodeMirror-CInCxHCy.js">
    <link rel="modulepreload" crossorigin href="./assets/error-banner-CHF-jGs2.js">
    <link rel="modulepreload" crossorigin href="./assets/defaultLocale-DEWTIUVh.js">
    <link rel="modulepreload" crossorigin href="./assets/precisionRound-BLxyDkD7.js">
    <link rel="modulepreload" crossorigin href="./assets/defaultLocale-B9-NA0ur.js">
    <link rel="modulepreload" crossorigin href="./assets/vega-loader.browser.module-B3yPAbRZ.js">
    <link rel="modulepreload" crossorigin href="./assets/loader-BcHzCbiy.js">
    <link rel="modulepreload" crossorigin href="./assets/formats-Dbfcbsil.js">
    <link rel="modulepreload" crossorigin href="./assets/en-US-D7J6fBFv.js">
    <link rel="modulepreload" crossorigin href="./assets/isValid-BxWQIw0s.js">
    <link rel="modulepreload" crossorigin href="./assets/dates-D2l0yAKQ.js">
    <link rel="modulepreload" crossorigin href="./assets/download-RtEDTktT.js">
    <link rel="modulepreload" crossorigin href="./assets/maps-duCv2i7k.js">
    <link rel="modulepreload" crossorigin href="./assets/useDateFormatter-BapFytxP.js">
    <link rel="modulepreload" crossorigin href="./assets/range-BB1DXJJn.js">
    <link rel="modulepreload" crossorigin href="./assets/list-filter-DQ2_e3bh.js">
    <link rel="modulepreload" crossorigin href="./assets/columns-BeFC1dXm.js">
    <link rel="modulepreload" crossorigin href="./assets/focus-BP3h9dJJ.js">
    <link rel="modulepreload" crossorigin href="./assets/useInstallPackage-CDwTdPy7.js">
    <link rel="modulepreload" crossorigin href="./assets/column-preview-CC6unPyM.js">
    <link rel="modulepreload" crossorigin href="./assets/useAddCell-ClSRUhA6.js">
    <link rel="modulepreload" crossorigin href="./assets/toggle-DL9DPBMc.js">
    <link rel="modulepreload" crossorigin href="./assets/useHotkey-CivJpvvx.js">
    <link rel="modulepreload" crossorigin href="./assets/globals-BGEnYYSz.js">
    <link rel="modulepreload" crossorigin href="./assets/mode-kUHLEZT6.js">
    <link rel="modulepreload" crossorigin href="./assets/share-ChWJhz87.js">
    <link rel="modulepreload" crossorigin href="./assets/dist-I8SxGjN9.js">
    <link rel="modulepreload" crossorigin href="./assets/memoize-CAcr7Wct.js">
    <link rel="modulepreload" crossorigin href="./assets/_toKey-Di_xoXjD.js">
    <link rel="modulepreload" crossorigin href="./assets/_baseSet-Dmzd-CnA.js">
    <link rel="modulepreload" crossorigin href="./assets/utilities.esm-Dj3BexHh.js">
    <link rel="modulepreload" crossorigin href="./assets/floating-outline-CwHsH4x8.js">
    <link rel="modulepreload" crossorigin href="./assets/eye-off-wMFrY47K.js">
    <link rel="modulepreload" crossorigin href="./assets/plus-Ckxr6pwY.js">
    <link rel="modulepreload" crossorigin href="./assets/readonly-python-code-DI18L7Ip.js">
    <link rel="modulepreload" crossorigin href="./assets/file-video-camera-D5oKA5-e.js">
    <link rel="modulepreload" crossorigin href="./assets/file-text-Ds68BFYI.js">
    <link rel="modulepreload" crossorigin href="./assets/file-BX8VjCCQ.js">
    <link rel="modulepreload" crossorigin href="./assets/types-Zo5TA9DG.js">
    <link rel="modulepreload" crossorigin href="./assets/label-CFxcdBki.js">
    <link rel="modulepreload" crossorigin href="./assets/form-mBAxBzPt.js">
    <link rel="modulepreload" crossorigin href="./assets/textarea-BcNYHZLG.js">
    <link rel="modulepreload" crossorigin href="./assets/circle-x-CPCvpiTN.js">
    <link rel="modulepreload" crossorigin href="./assets/refresh-ccw-D1hQMnx_.js">
    <link rel="modulepreload" crossorigin href="./assets/trash-2-Cex53SxB.js">
    <link rel="modulepreload" crossorigin href="./assets/form-CN-qI0dC.js">
    <link rel="modulepreload" crossorigin href="./assets/field-D-WfasXC.js">
    <link rel="modulepreload" crossorigin href="./assets/switch-C2Bk9ykO.js">
    <link rel="modulepreload" crossorigin href="./assets/useBoolean-7LAl9weo.js">
    <link rel="modulepreload" crossorigin href="./assets/useDeepCompareMemoize-CbO9MTKn.js">
    <link rel="modulepreload" crossorigin href="./assets/types-TRUculCV.js">
    <link rel="modulepreload" crossorigin href="./assets/prop-types-ShpF60yB.js">
    <link rel="modulepreload" crossorigin href="./assets/es-W4OhtMWM.js">
    <link rel="modulepreload" crossorigin href="./assets/VisuallyHidden-BfudlHw2.js">
    <link rel="modulepreload" crossorigin href="./assets/_baseFlatten-8yEsQJi9.js">
    <link rel="modulepreload" crossorigin href="./assets/get-BYzWDFJH.js">
    <link rel="modulepreload" crossorigin href="./assets/hasIn-WaG0qjy7.js">
    <link rel="modulepreload" crossorigin href="./assets/_basePickBy-6ZBTv_cn.js">
    <link rel="modulepreload" crossorigin href="./assets/pick-BZA77Trx.js">
    <link rel="modulepreload" crossorigin href="./assets/square-DpWGO_-7.js">
    <link rel="modulepreload" crossorigin href="./assets/chart-no-axes-column-3piSAXMi.js">
    <link rel="modulepreload" crossorigin href="./assets/download-CHejLEQn.js">
    <link rel="modulepreload" crossorigin href="./assets/globe-TqnwljOq.js">
    <link rel="modulepreload" crossorigin href="./assets/send-D9MERKWw.js">
    <link rel="modulepreload" crossorigin href="./assets/refresh-cw-CmHE3eNl.js">
    <link rel="modulepreload" crossorigin href="./assets/settings-ByREbWaw.js">
    <link rel="modulepreload" crossorigin href="./assets/square-function-B5j-8u3J.js">
    <link rel="modulepreload" crossorigin href="./assets/bundle.esm-BoludFkg.js">
    <link rel="stylesheet" crossorigin href="./assets/documentation-BvrC6Bsv.css">
    <link rel="stylesheet" crossorigin href="./assets/columns-j3zW187k.css">
    <link rel="stylesheet" crossorigin href="./assets/index-DrbV-Ps3.css">
  <marimo-wasm hidden=""></marimo-wasm>
    <script>
        if (window.location.protocol === 'file:') {
            alert('Warning: This file must be served by an HTTP server to function correctly.');
        }
    </script>
    
    <style>
        #save-button {
            display: none !important;
        }
        #filename-input {
            display: none !important;
        }
    </style>
    <marimo-code hidden="">import%20marimo%0A%0A__generated_with%20%3D%20%220.17.0%22%0Aapp%20%3D%20marimo.App(width%3D%22medium%22)%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%0A%20%20%20%20%20%20%20%20r%22%22%22%0A%20%20%20%20%23%20Calculate%20Irradiance%20for%20TI%20XPR%20Projector%0A%0A%20%20%20%20%23%23%20Basic%20Idea%0A%0A%20%20%20%20See%20%5BUnderstanding%20the%20XPR%20Technology%5D(https%3A%2F%2Fawolvision.com%2Fblogs%2Fawol-vision-blog%2Funderstanding-xpr-technology-for-4k-dlp-projectors)%20and%20the%20image%20below%20for%20an%20explanation%20of%20how%20XPR%20works.%20In%20summary%2C%20the%20technique%20is%20intended%20to%20double%20the%20apparent%20resolution%20of%20a%20projected%20image%20compared%20to%20the%20actual%20physical%20resolution%20of%20the%20projected%20micromirror%20array.%20For%20example%2C%20our%20Anycubic%20DLP%203D%20printer%20projects%20an%20image%20with%20a%20102%20%26mu%3Bm%20pixel%20pitch.%20However%2C%20the%20claimed%20resolution%20is%2051%20%26mu%3Bm%2C%20which%20is%20achieved%20by%20rapidly%20projecting%20four%20sequential%20102%20%26mu%3Bm%20pixel%20images%20to%20construct%20a%2051%20%26mu%3Bm%20image.%20The%2051%20%26mu%3Bm%20image%20is%20considered%20to%20be%20the%20integration%20over%20time%20of%20the%204%20sequential%20images.%20This%20makes%20sense%20if%20the%20temporal%20sequencing%20is%20faster%20than%20the%20physical%20system%20can%20respond%2C%20such%20as%20the%20human%20visual%20system%20when%20viewing%20a%20video.%20However%2C%20it%20does%20not%20mean%20that%20no%20light%20is%20projected%20into%20every%2051%20%26mu%3Bm%20pixel%20that%20is%20supposed%20to%20be%20dark%2C%20which%20can%20be%20seen%20by%20playing%20with%20the%20visualization%20on%20this%20page.%20%0A%0A%20%20%20%20As%20shown%20in%20the%20image%20below%2C%20the%20four-image%20sequence%20is%20achieved%20by%20rapidly%20rotating%20a%20tilted%20glass%20window.%0A%0A%20%20%20%201.%20Unshifted%20image%0A%20%20%20%202.%20Shifted%20up%20by%201%2F2%20pixel%20(i.e.%2C%201%2F2%20of%20a%20102%20%26mu%3Bm%20pixel)%0A%20%20%20%203.%20Shifted%20up%20and%20right%20by%201%2F2%20pixel%0A%20%20%20%204.%20Shifted%20right%20by%201%2F2%20pixel%0A%20%20%20%20%22%22%22%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.image(src%3D%22public%2Fxpr_visual.jpg%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%0A%20%20%20%20%20%20%20%20r%22%22%22%0A%20%20%20%20%23%23%20Visualization%0A%0A%20%20%20%20Below%20are%20four%205x5%20arrays%20of%20102%20%26mu%3Bm%20pixels%2C%20one%20for%20each%20of%20the%20XPR%20shifts%2C%20and%20the%20output%20image%20created%20by%20their%20temporal%20overlap.%20Click%20on%20the%20pixels%20of%20each%20image%20to%20toggle%20them%20on%20and%20off%20and%20observe%20the%20resultant%20combined%20image%20in%20the%20bottom%20plot.%0A%20%20%20%20%22%22%22%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(%0A%20%20%20%20fill_factor_2D%2C%0A%20%20%20%20irradiance_threshold%2C%0A%20%20%20%20mo%2C%0A%20%20%20%20overlap_image%2C%0A%20%20%20%20plot_irradiance_pattern%2C%0A%20%20%20%20rawimage0%2C%0A%20%20%20%20rawimage1%2C%0A%20%20%20%20rawimage2%2C%0A%20%20%20%20rawimage3%2C%0A%20%20%20%20set_all_to_black%2C%0A%20%20%20%20set_all_to_white%2C%0A%20%20%20%20xlim%2C%0A%20%20%20%20ylim%2C%0A)%3A%0A%20%20%20%20%23%20plot_fig%2C%20plot_ax%20%3D%20create_plot()%20%23irradiance_threshold.value)%0A%20%20%20%20plot_fig%2C%20plot_ax%20%3D%20plot_irradiance_pattern(overlap_image%2C%20xlim%2C%20ylim%2C%20irradiance_threshold.value)%0A%0A%20%20%20%20%23%20Display%20it%0A%20%20%20%20mo.vstack(%5B%0A%20%20%20%20%20%20%20%20mo.md(%22%23%23%23%20Individual%20102%20%26mu%3Bm%20Pixel%20Images%22)%2C%0A%20%20%20%20%20%20%20%20mo.md(%22Shift%20%2By%22%20%2B%20%22%26nbsp%3B%22*38%20%2B%22Shift%20%2Bxy%22)%2C%0A%20%20%20%20%20%20%20%20mo.hstack(%5Brawimage1%2C%20rawimage2%5D%2C%20justify%3D%22start%22)%2C%0A%20%20%20%20%20%20%20%20mo.md(%22Unshifted%22%20%2B%20%22%26nbsp%3B%22*37%20%2B%22Shift%20%2Bx%22)%2C%0A%20%20%20%20%20%20%20%20mo.hstack(%5Brawimage0%2C%20rawimage3%5D%2C%20justify%3D%22start%22)%2C%0A%20%20%20%20%20%20%20%20mo.hstack(%5Bplot_ax%2C%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20mo.vstack(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20set_all_to_black%2C%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20set_all_to_white%2C%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20fill_factor_2D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20irradiance_threshold%2C%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5D%2C%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20justify%3D%22center%22)%5D%2C%20justify%3D%22start%22)%0A%20%20%20%20%5D)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20import%20marimo%20as%20mo%0A%20%20%20%20import%20anywidget%0A%20%20%20%20import%20traitlets%0A%20%20%20%20import%20numpy%20as%20np%0A%20%20%20%20import%20matplotlib.pyplot%20as%20plt%0A%20%20%20%20return%20anywidget%2C%20mo%2C%20np%2C%20plt%2C%20traitlets%0A%0A%0A%40app.cell%0Adef%20_(anywidget%2C%20traitlets)%3A%0A%20%20%20%20class%20ToggleGrid(anywidget.AnyWidget)%3A%0A%20%20%20%20%20%20%20%20_esm%20%3D%20%22%22%22%0A%20%20%20%20%20%20%20%20function%20render(%7B%20model%2C%20el%20%7D)%20%7B%0A%20%20%20%20%20%20%20%20%20%20const%20size%20%3D%205%3B%0A%20%20%20%20%20%20%20%20%20%20const%20squareSize%20%3D%2040%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%2F%2F%20Initialize%20grid%20state%20from%20model%20or%20create%20new%0A%20%20%20%20%20%20%20%20%20%20let%20grid%20%3D%20model.get(%22grid%22)%3B%0A%20%20%20%20%20%20%20%20%20%20if%20(!grid%20%7C%7C%20grid.length%20%3D%3D%3D%200)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20grid%20%3D%20Array(size).fill().map(()%20%3D%3E%20Array(size).fill(false))%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20model.set(%22grid%22%2C%20grid)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20model.save_changes()%3B%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%20%20%2F%2F%20Create%20container%0A%20%20%20%20%20%20%20%20%20%20const%20container%20%3D%20document.createElement(%22div%22)%3B%0A%20%20%20%20%20%20%20%20%20%20container.style.display%20%3D%20%22inline-block%22%3B%0A%20%20%20%20%20%20%20%20%20%20container.style.border%20%3D%20%222px%20solid%20%23333%22%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%2F%2F%20Create%20grid%0A%20%20%20%20%20%20%20%20%20%20const%20gridEl%20%3D%20document.createElement(%22div%22)%3B%0A%20%20%20%20%20%20%20%20%20%20gridEl.style.display%20%3D%20%22grid%22%3B%0A%20%20%20%20%20%20%20%20%20%20gridEl.style.gridTemplateColumns%20%3D%20%60repeat(%24%7Bsize%7D%2C%20%24%7BsquareSize%7Dpx)%60%3B%0A%20%20%20%20%20%20%20%20%20%20gridEl.style.gap%20%3D%20%220%22%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%2F%2F%20Create%20squares%0A%20%20%20%20%20%20%20%20%20%20const%20squares%20%3D%20%5B%5D%3B%0A%20%20%20%20%20%20%20%20%20%20for%20(let%20i%20%3D%200%3B%20i%20%3C%20size%3B%20i%2B%2B)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20squares%5Bi%5D%20%3D%20%5B%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20for%20(let%20j%20%3D%200%3B%20j%20%3C%20size%3B%20j%2B%2B)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20const%20square%20%3D%20document.createElement(%22div%22)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20square.style.width%20%3D%20%60%24%7BsquareSize%7Dpx%60%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20square.style.height%20%3D%20%60%24%7BsquareSize%7Dpx%60%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20square.style.border%20%3D%20%221px%20solid%20%23666%22%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20square.style.cursor%20%3D%20%22pointer%22%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20square.style.backgroundColor%20%3D%20grid%5Bi%5D%5Bj%5D%20%3F%20%22white%22%20%3A%20%22black%22%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20square.addEventListener(%22click%22%2C%20()%20%3D%3E%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20grid%5Bi%5D%5Bj%5D%20%3D%20!grid%5Bi%5D%5Bj%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20square.style.backgroundColor%20%3D%20grid%5Bi%5D%5Bj%5D%20%3F%20%22white%22%20%3A%20%22black%22%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20Create%20a%20new%20array%20to%20trigger%20change%20detection%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20const%20newGrid%20%3D%20grid.map(row%20%3D%3E%20%5B...row%5D)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20model.set(%22grid%22%2C%20newGrid)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20model.save_changes()%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20grid%20%3D%20newGrid%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D)%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20squares%5Bi%5D%5Bj%5D%20%3D%20square%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20gridEl.appendChild(square)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%20%20%2F%2F%20Listen%20for%20reset_trigger%20changes%0A%20%20%20%20%20%20%20%20%20%20model.on(%22change%3Areset_trigger%22%2C%20()%20%3D%3E%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20Reset%20the%20grid%0A%20%20%20%20%20%20%20%20%20%20%20%20grid%20%3D%20Array(size).fill().map(()%20%3D%3E%20Array(size).fill(false))%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20model.set(%22grid%22%2C%20grid)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20model.save_changes()%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20Update%20visual%0A%20%20%20%20%20%20%20%20%20%20%20%20for%20(let%20i%20%3D%200%3B%20i%20%3C%20size%3B%20i%2B%2B)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20for%20(let%20j%20%3D%200%3B%20j%20%3C%20size%3B%20j%2B%2B)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20squares%5Bi%5D%5Bj%5D.style.backgroundColor%20%3D%20%22black%22%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%7D)%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%2F%2F%20Listen%20for%20set_all_trigger%20changes%0A%20%20%20%20%20%20%20%20%20%20model.on(%22change%3Aset_all_trigger%22%2C%20()%20%3D%3E%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20Set%20all%20to%20true%0A%20%20%20%20%20%20%20%20%20%20%20%20grid%20%3D%20Array(size).fill().map(()%20%3D%3E%20Array(size).fill(true))%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20model.set(%22grid%22%2C%20grid)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20model.save_changes()%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20Update%20visual%0A%20%20%20%20%20%20%20%20%20%20%20%20for%20(let%20i%20%3D%200%3B%20i%20%3C%20size%3B%20i%2B%2B)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20for%20(let%20j%20%3D%200%3B%20j%20%3C%20size%3B%20j%2B%2B)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20squares%5Bi%5D%5Bj%5D.style.backgroundColor%20%3D%20%22white%22%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%7D)%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%2F%2F%20Listen%20for%20model%20changes%0A%20%20%20%20%20%20%20%20%20%20model.on(%22change%3Agrid%22%2C%20()%20%3D%3E%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20const%20newGrid%20%3D%20model.get(%22grid%22)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20grid%20%3D%20newGrid%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20for%20(let%20i%20%3D%200%3B%20i%20%3C%20size%3B%20i%2B%2B)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20for%20(let%20j%20%3D%200%3B%20j%20%3C%20size%3B%20j%2B%2B)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20squares%5Bi%5D%5Bj%5D.style.backgroundColor%20%3D%20newGrid%5Bi%5D%5Bj%5D%20%3F%20%22white%22%20%3A%20%22black%22%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%7D)%3B%0A%0A%20%20%20%20%20%20%20%20%20%20container.appendChild(gridEl)%3B%0A%20%20%20%20%20%20%20%20%20%20el.appendChild(container)%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20export%20default%20%7B%20render%20%7D%3B%0A%20%20%20%20%20%20%20%20%22%22%22%0A%0A%20%20%20%20%20%20%20%20grid%20%3D%20traitlets.List(%5B%5D).tag(sync%3DTrue)%0A%20%20%20%20%20%20%20%20reset_trigger%20%3D%20traitlets.Int(0).tag(sync%3DTrue)%0A%20%20%20%20%20%20%20%20set_all_trigger%20%3D%20traitlets.Int(0).tag(sync%3DTrue)%0A%0A%20%20%20%20%20%20%20%20def%20__init__(self)%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20Initialize%20with%205x5%20grid%20of%20False%20(black)%0A%20%20%20%20%20%20%20%20%20%20%20%20self.grid%20%3D%20%5B%5BFalse%20for%20_%20in%20range(5)%5D%20for%20_%20in%20range(5)%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20super().__init__()%0A%20%20%20%20return%20(ToggleGrid%2C)%0A%0A%0A%40app.cell%0Adef%20_(ToggleGrid%2C%20mo)%3A%0A%20%20%20%20%23%20Create%20widgets%0A%20%20%20%20_toggle_grid_instance0%20%3D%20ToggleGrid()%0A%20%20%20%20rawimage0%20%3D%20mo.ui.anywidget(_toggle_grid_instance0)%0A%20%20%20%20_toggle_grid_instance1%20%3D%20ToggleGrid()%0A%20%20%20%20rawimage1%20%3D%20mo.ui.anywidget(_toggle_grid_instance1)%0A%20%20%20%20_toggle_grid_instance2%20%3D%20ToggleGrid()%0A%20%20%20%20rawimage2%20%3D%20mo.ui.anywidget(_toggle_grid_instance2)%0A%20%20%20%20_toggle_grid_instance3%20%3D%20ToggleGrid()%0A%20%20%20%20rawimage3%20%3D%20mo.ui.anywidget(_toggle_grid_instance3)%0A%0A%20%20%20%20fill_factor_2D%20%3D%20mo.ui.number(start%3D0.2%2C%20stop%3D1.0%2C%20label%3D%22Pixel%20fill%20factor%22%2C%20value%3D0.68)%0A%0A%20%20%20%20def%20reset_grid()%3A%0A%20%20%20%20%20%20%20%20%22%22%22Call%20this%20function%20to%20reset%20the%20grid%22%22%22%0A%20%20%20%20%20%20%20%20_toggle_grid_instance0.reset_trigger%20%2B%3D%201%0A%20%20%20%20%20%20%20%20_toggle_grid_instance1.reset_trigger%20%2B%3D%201%0A%20%20%20%20%20%20%20%20_toggle_grid_instance2.reset_trigger%20%2B%3D%201%0A%20%20%20%20%20%20%20%20_toggle_grid_instance3.reset_trigger%20%2B%3D%201%0A%0A%20%20%20%20%23%20Set%20all%20function%0A%20%20%20%20def%20set_all_grid()%3A%0A%20%20%20%20%20%20%20%20%22%22%22Call%20this%20function%20to%20set%20all%20grid%20values%20to%20True%22%22%22%0A%20%20%20%20%20%20%20%20_toggle_grid_instance0.set_all_trigger%20%2B%3D%201%0A%20%20%20%20%20%20%20%20_toggle_grid_instance1.set_all_trigger%20%2B%3D%201%0A%20%20%20%20%20%20%20%20_toggle_grid_instance2.set_all_trigger%20%2B%3D%201%0A%20%20%20%20%20%20%20%20_toggle_grid_instance3.set_all_trigger%20%2B%3D%201%0A%0A%20%20%20%20set_all_to_black%20%3D%20mo.ui.button(label%3D%22All%20pixels%20off%22%2C%20on_click%3Dlambda%20_%3A%20reset_grid())%0A%20%20%20%20set_all_to_white%20%3D%20mo.ui.button(label%3D%22All%20pixels%20on%22%2C%20on_click%3Dlambda%20_%3A%20set_all_grid())%0A%0A%20%20%20%20irradiance_threshold%20%3D%20mo.ui.dropdown(options%3D%5B%221%20or%20more%22%2C%20%222%20or%20more%22%2C%20%223%20or%20more%22%2C%20%224%22%5D%2C%20label%3D%22Threshold%3A%20overlapping%20images%22%2C%20value%3D%221%20or%20more%22)%0A%20%20%20%20return%20(%0A%20%20%20%20%20%20%20%20fill_factor_2D%2C%0A%20%20%20%20%20%20%20%20irradiance_threshold%2C%0A%20%20%20%20%20%20%20%20rawimage0%2C%0A%20%20%20%20%20%20%20%20rawimage1%2C%0A%20%20%20%20%20%20%20%20rawimage2%2C%0A%20%20%20%20%20%20%20%20rawimage3%2C%0A%20%20%20%20%20%20%20%20set_all_to_black%2C%0A%20%20%20%20%20%20%20%20set_all_to_white%2C%0A%20%20%20%20)%0A%0A%0A%40app.cell%0Adef%20_(np)%3A%0A%20%20%20%20def%20extract_np_array(rawimage_grid%2C%20max_value%3D1)%3A%0A%20%20%20%20%20%20%20%20return%20np.array(rawimage_grid%5B%3A%3A-1%5D).astype(float)%20*%20max_value%0A%20%20%20%20return%20(extract_np_array%2C)%0A%0A%0A%40app.cell%0Adef%20_(%0A%20%20%20%20create_grid_pattern%2C%0A%20%20%20%20extract_np_array%2C%0A%20%20%20%20fill_factor_2D%2C%0A%20%20%20%20np%2C%0A%20%20%20%20rawimage0%2C%0A%20%20%20%20rawimage1%2C%0A%20%20%20%20rawimage2%2C%0A%20%20%20%20rawimage3%2C%0A%20%20%20%20render_rectangles_direct%2C%0A%20%20%20%20shift_rectangles%2C%0A)%3A%0A%20%20%20%20%23%20Parameters%0A%20%20%20%20grid_size%20%3D%205%0A%20%20%20%20square_size%20%3D%201.0%20%20%23%20Grid%20spacing%0A%20%20%20%20%23%20fill_factor_2D%20%3D%200.68%20%20%23%2068%25%202D%20fill%20factor%0A%20%20%20%20fill_factor_1D%20%3D%20np.sqrt(fill_factor_2D.value)%20%20%23%201D%20fill%20factor%0A%20%20%20%20pixels_per_square%20%3D%2050%20%20%23%20Number%20of%20pixels%20per%20grid%20square%0A%0A%20%20%20%20%23%20Calculate%20image%20size%20based%20on%20pixels%20per%20square%0A%20%20%20%20xlim%20%3D%20(0%2C%20grid_size%20*%20square_size%20%2B%200.5%20*%20square_size)%0A%20%20%20%20ylim%20%3D%20(0%2C%20grid_size%20*%20square_size%20%2B%200.5%20*%20square_size)%0A%20%20%20%20img_width%20%3D%20int((xlim%5B1%5D%20-%20xlim%5B0%5D)%20*%20pixels_per_square)%0A%20%20%20%20img_height%20%3D%20int((ylim%5B1%5D%20-%20ylim%5B0%5D)%20*%20pixels_per_square)%0A%20%20%20%20img_size%20%3D%20(img_height%2C%20img_width)%0A%0A%20%20%20%20%23%20Create%20the%20base%20grid%20with%20fill%20factor%0A%20%20%20%20rectangles_unshifted%20%3D%20create_grid_pattern(%0A%20%20%20%20%20%20%20%20grid_size%2C%20square_size%2C%20fill_factor_1D%2C%20extract_np_array(rawimage0.value%5B%22grid%22%5D))%0A%0A%20%20%20%20%23%20Create%20shifted%20grids%0A%20%20%20%20shift_amount%20%3D%200.5%20*%20square_size%0A%20%20%20%20rectangles_shifted_x%20%3D%20shift_rectangles(%0A%20%20%20%20%20%20%20%20create_grid_pattern(%0A%20%20%20%20%20%20%20%20%20%20%20%20grid_size%2C%20%0A%20%20%20%20%20%20%20%20%20%20%20%20square_size%2C%20%0A%20%20%20%20%20%20%20%20%20%20%20%20fill_factor_1D%2C%20%0A%20%20%20%20%20%20%20%20%20%20%20%20extract_np_array(rawimage3.value%5B%22grid%22%5D)%0A%20%20%20%20%20%20%20%20)%2C%20%0A%20%20%20%20%20%20%20%20shift_x%3Dshift_amount%2C%20%0A%20%20%20%20%20%20%20%20shift_y%3D0%0A%20%20%20%20)%0A%20%20%20%20rectangles_shifted_y%20%3D%20shift_rectangles(%0A%20%20%20%20%20%20%20%20create_grid_pattern(%0A%20%20%20%20%20%20%20%20%20%20%20%20grid_size%2C%20%0A%20%20%20%20%20%20%20%20%20%20%20%20square_size%2C%20%0A%20%20%20%20%20%20%20%20%20%20%20%20fill_factor_1D%2C%20%0A%20%20%20%20%20%20%20%20%20%20%20%20extract_np_array(rawimage1.value%5B%22grid%22%5D)%0A%20%20%20%20%20%20%20%20)%2C%20%0A%20%20%20%20%20%20%20%20shift_x%3D0%2C%20%0A%20%20%20%20%20%20%20%20shift_y%3Dshift_amount)%0A%20%20%20%20rectangles_shifted_xy%20%3D%20shift_rectangles(%0A%20%20%20%20%20%20%20%20create_grid_pattern(%0A%20%20%20%20%20%20%20%20%20%20%20%20grid_size%2C%20%0A%20%20%20%20%20%20%20%20%20%20%20%20square_size%2C%20%0A%20%20%20%20%20%20%20%20%20%20%20%20fill_factor_1D%2C%20%0A%20%20%20%20%20%20%20%20%20%20%20%20extract_np_array(rawimage2.value%5B%22grid%22%5D)%0A%20%20%20%20%20%20%20%20)%2C%20%0A%20%20%20%20%20%20%20%20shift_x%3Dshift_amount%2C%20%0A%20%20%20%20%20%20%20%20shift_y%3Dshift_amount%0A%20%20%20%20)%0A%0A%20%20%20%20%23%20print(rectangles_unshifted)%0A%0A%20%20%20%20%23%20Combine%20all%20four%20grids%0A%20%20%20%20all_rectangles%20%3D%20rectangles_unshifted%20%2B%20rectangles_shifted_x%20%2B%20rectangles_shifted_y%20%2B%20rectangles_shifted_xy%0A%0A%20%20%20%20overlap_image%20%3D%20render_rectangles_direct(all_rectangles%2C%20img_size%2C%20xlim%2C%20ylim)%0A%20%20%20%20return%20overlap_image%2C%20xlim%2C%20ylim%0A%0A%0A%40app.cell%0Adef%20_(plt)%3A%0A%20%20%20%20def%20plot_irradiance_pattern(img_data%2C%20xlim%2C%20ylim%2C%20threshold)%3A%0A%20%20%20%20%20%20%20%20eps%20%3D%201e-1%0A%20%20%20%20%20%20%20%20if%20threshold%20%3D%3D%20%221%20or%20more%22%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20vmin%20%3D%200%0A%20%20%20%20%20%20%20%20elif%20threshold%20%3D%3D%20%222%20or%20more%22%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20vmin%20%3D%201%20%2B%20eps%0A%20%20%20%20%20%20%20%20elif%20threshold%20%3D%3D%20%223%20or%20more%22%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20vmin%20%3D%202%20%2B%20eps%0A%20%20%20%20%20%20%20%20elif%20threshold%20%3D%3D%20%224%22%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20vmin%20%3D%203%20%2B%20eps%0A%20%20%20%20%20%20%20%20else%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20raise%20ValueError(f%22Incorrect%20threshold%3A%20%7Bthreshold%7D%22)%0A%20%20%20%20%20%20%20%20fig%2C%20ax%20%3D%20plt.subplots()%20%23%202%2C%203%2C%20figsize%3D(15%2C%2010))%0A%20%20%20%20%20%20%20%20img%20%3D%20ax.imshow(%0A%20%20%20%20%20%20%20%20%20%20%20%20img_data%2C%20%0A%20%20%20%20%20%20%20%20%20%20%20%20cmap%3D'gray'%2C%20%0A%20%20%20%20%20%20%20%20%20%20%20%20interpolation%3D'nearest'%2C%20%0A%20%20%20%20%20%20%20%20%20%20%20%20origin%3D'lower'%2C%20%0A%20%20%20%20%20%20%20%20%20%20%20%20extent%3D%5Bxlim%5B0%5D%2C%20xlim%5B1%5D%2C%20ylim%5B0%5D%2C%20ylim%5B1%5D%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20vmin%3Dvmin%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20vmax%3D4%0A%20%20%20%20%20%20%20%20)%0A%20%20%20%20%20%20%20%20ax.set_title('All%20Four%20Patterns%20Overlapped')%0A%20%20%20%20%20%20%20%20ax.set_xlabel(r'x%20(102%20%24%5Cmu%24m%20pixels)')%0A%20%20%20%20%20%20%20%20ax.set_ylabel(r'y%20(102%20%24%5Cmu%24m%20pixels)')%0A%20%20%20%20%20%20%20%20ax.grid(True%2C%20alpha%3D0.3)%0A%20%20%20%20%20%20%20%20ax.set_aspect('equal')%0A%20%20%20%20%20%20%20%20return%20fig%2C%20ax%0A%20%20%20%20return%20(plot_irradiance_pattern%2C)%0A%0A%0A%40app.cell%0Adef%20_(np)%3A%0A%20%20%20%20def%20create_grid_pattern(grid_size%3D5%2C%20square_size%3D1.0%2C%20fill_factor%3D1.0%2C%20pattern%3DNone)%3A%0A%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20%20%20%20%20Create%20a%20list%20of%20rectangles%20based%20on%20a%205x5%20grid%20pattern.%0A%0A%20%20%20%20%20%20%20%20Parameters%3A%0A%20%20%20%20%20%20%20%20-%20grid_size%3A%20size%20of%20the%20grid%20(5%20for%205x5)%0A%20%20%20%20%20%20%20%20-%20square_size%3A%20size%20of%20each%20grid%20cell%20(spacing%20between%20squares)%0A%20%20%20%20%20%20%20%20-%20fill_factor%3A%201D%20fraction%20of%20the%20grid%20cell%20that%20is%20filled%20(0%20to%201)%0A%20%20%20%20%20%20%20%20-%20pattern%3A%202D%20array%20of%200s%20and%201s%20indicating%20which%20squares%20are%20active%0A%0A%20%20%20%20%20%20%20%20Returns%3A%0A%20%20%20%20%20%20%20%20-%20List%20of%20rectangle%20tuples%20(x%2C%20y%2C%20width%2C%20height)%0A%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20%20%20%20%20if%20pattern%20is%20None%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20Default%20pattern%20-%20checkerboard%0A%20%20%20%20%20%20%20%20%20%20%20%20pattern%20%3D%20np.zeros((grid_size%2C%20grid_size))%0A%20%20%20%20%20%20%20%20%20%20%20%20pattern%5B%3A%3A2%2C%20%3A%3A2%5D%20%3D%201%0A%20%20%20%20%20%20%20%20%20%20%20%20pattern%5B1%3A%3A2%2C%201%3A%3A2%5D%20%3D%201%0A%0A%20%20%20%20%20%20%20%20rectangles%20%3D%20%5B%5D%0A%20%20%20%20%20%20%20%20actual_square_size%20%3D%20square_size%20*%20fill_factor%0A%20%20%20%20%20%20%20%20offset%20%3D%20(square_size%20-%20actual_square_size)%20%2F%202%20%20%23%20Center%20the%20square%20in%20the%20grid%20cell%0A%0A%20%20%20%20%20%20%20%20for%20i%20in%20range(grid_size)%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20for%20j%20in%20range(grid_size)%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20pattern%5Bi%2C%20j%5D%20%3D%3D%201%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20x%20%3D%20j%20*%20square_size%20%2B%20offset%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20y%20%3D%20i%20*%20square_size%20%2B%20offset%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20rectangles.append((x%2C%20y%2C%20actual_square_size%2C%20actual_square_size))%0A%0A%20%20%20%20%20%20%20%20return%20rectangles%0A%0A%20%20%20%20def%20shift_rectangles(rectangles%2C%20shift_x%3D0%2C%20shift_y%3D0)%3A%0A%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20%20%20%20%20Shift%20all%20rectangles%20by%20given%20amounts.%0A%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20%20%20%20%20return%20%5B(x%20%2B%20shift_x%2C%20y%20%2B%20shift_y%2C%20w%2C%20h)%20for%20x%2C%20y%2C%20w%2C%20h%20in%20rectangles%5D%0A%0A%20%20%20%20def%20render_rectangles_direct(rectangles%2C%20img_size%3D(500%2C%20500)%2C%20xlim%3D(0%2C%205)%2C%20ylim%3D(0%2C%205))%3A%0A%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20%20%20%20%20Directly%20rasterize%20rectangles%20to%20count%20overlaps.%0A%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20%20%20%20%20overlap_image%20%3D%20np.zeros(img_size)%0A%0A%20%20%20%20%20%20%20%20for%20x%2C%20y%2C%20width%2C%20height%20in%20rectangles%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20Convert%20rectangle%20coordinates%20to%20pixel%20coordinates%0A%20%20%20%20%20%20%20%20%20%20%20%20x_start%20%3D%20int((x%20-%20xlim%5B0%5D)%20%2F%20(xlim%5B1%5D%20-%20xlim%5B0%5D)%20*%20img_size%5B1%5D)%0A%20%20%20%20%20%20%20%20%20%20%20%20x_end%20%3D%20int((x%20%2B%20width%20-%20xlim%5B0%5D)%20%2F%20(xlim%5B1%5D%20-%20xlim%5B0%5D)%20*%20img_size%5B1%5D)%0A%20%20%20%20%20%20%20%20%20%20%20%20y_start%20%3D%20int((y%20-%20ylim%5B0%5D)%20%2F%20(ylim%5B1%5D%20-%20ylim%5B0%5D)%20*%20img_size%5B0%5D)%0A%20%20%20%20%20%20%20%20%20%20%20%20y_end%20%3D%20int((y%20%2B%20height%20-%20ylim%5B0%5D)%20%2F%20(ylim%5B1%5D%20-%20ylim%5B0%5D)%20*%20img_size%5B0%5D)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20Clamp%20to%20image%20boundaries%0A%20%20%20%20%20%20%20%20%20%20%20%20x_start%20%3D%20max(0%2C%20min(x_start%2C%20img_size%5B1%5D))%0A%20%20%20%20%20%20%20%20%20%20%20%20x_end%20%3D%20max(0%2C%20min(x_end%2C%20img_size%5B1%5D))%0A%20%20%20%20%20%20%20%20%20%20%20%20y_start%20%3D%20max(0%2C%20min(y_start%2C%20img_size%5B0%5D))%0A%20%20%20%20%20%20%20%20%20%20%20%20y_end%20%3D%20max(0%2C%20min(y_end%2C%20img_size%5B0%5D))%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20Add%201%20to%20the%20overlap%20count%20in%20this%20rectangle%20region%0A%20%20%20%20%20%20%20%20%20%20%20%20overlap_image%5By_start%3Ay_end%2C%20x_start%3Ax_end%5D%20%2B%3D%201%0A%0A%20%20%20%20%20%20%20%20return%20overlap_image%0A%20%20%20%20return%20create_grid_pattern%2C%20render_rectangles_direct%2C%20shift_rectangles%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20return%0A%0A%0Aif%20__name__%20%3D%3D%20%22__main__%22%3A%0A%20%20%20%20app.run()%0A</marimo-code></head>
  <body>
    <div id="root"></div>
    <!-- This is a portal for the data editor to render in -->
    <div id="portal" data-testid="glide-portal" style="position: fixed; left: 0; top: 0; z-index: 9999"></div>
    <script data-marimo="true">
      window.__MARIMO_MOUNT_CONFIG__ = {
            "filename": "notebook.py",
            "mode": "read",
            "version": "0.17.0",
            "serverToken": "unused",
            "config": {"ai": {"models": {"custom_models": [], "displayed_models": []}}, "completion": {"activate_on_typing": true, "copilot": false}, "diagnostics": {"sql_linter": true}, "display": {"cell_output": "above", "code_editor_font_size": 14, "dataframes": "rich", "default_table_max_columns": 50, "default_table_page_size": 10, "default_width": "medium", "reference_highlighting": false, "theme": "light"}, "formatting": {"line_length": 79}, "keymap": {"overrides": {}, "preset": "default"}, "language_servers": {"pylsp": {"enable_flake8": false, "enable_mypy": true, "enable_pydocstyle": false, "enable_pyflakes": false, "enable_pylint": false, "enable_ruff": true, "enabled": true}}, "mcp": {"mcpServers": {}, "presets": []}, "package_management": {"manager": "pip"}, "runtime": {"auto_instantiate": true, "auto_reload": "off", "default_sql_output": "auto", "on_cell_change": "autorun", "output_max_bytes": 8000000, "reactive_tests": true, "std_stream_max_bytes": 1000000, "watcher_on_save": "lazy"}, "save": {"autosave": "off", "autosave_delay": 1000, "format_on_save": false}, "server": {"browser": "default", "follow_symlink": false}, "snippets": {"custom_paths": [], "include_default_snippets": true}},
            "configOverrides": {},
            "appConfig": {"sql_output": "auto", "width": "medium"},
            "view": {"showAppCode": false},
            "notebook": null,
            "session": null,
            "runtimeConfig": null,
        };
    </script>
  </body>
</html>
